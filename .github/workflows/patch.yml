name: patch

on: workflow_dispatch

#on:  
  #schedule:
  # - cron: "0 13 * * 1"

jobs:
  setup-env:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v5
        with:
          fetch-depth: 0
          
      - run: echo "CURRENT_TAG=`echo $(git describe --tags --abbrev=0)`" >> $GITHUB_OUTPUT
      - run: echo "COMMIT_COUNT=`echo $(git rev-list --count $CURRENT_TAG..master)`" >> $GITHUB_OUTPUT
      - if: ${{env.COMMIT_COUNT >= 5}}
        run: echo "NEW_TAG=echo $CURRENT_TAG | awk 'BEGIN{FS=OFS="."} {$3+=1} 1'" >> $GITHUB_OUTPUT
      - name: Environments
        run: |
          echo "CURRENT_TAG: $CURRENT_TAG"
          echo "NEW_TAG: $NEW_TAG"
          echo "COMMIT_COUNT: $COMMIT_COUNT"
  make-patch:
    needs: setup-env
    
    runs-on: ubuntu-latest

    if: ${{needs.setup-env.outputs.COMMIT_COUNT >= 5}}
    steps:
      - uses: actions/checkout@v5
        with:
          fetch-depth: 0
      - run: echo "patch"
