name: patch

on: workflow_dispatch

#on:  
  #schedule:
  # - cron: "0 13 * * 1"

jobs:
  setup-env:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v5
        with:
          fetch-depth: 0
          
      - run: |
          echo "CURRENT_TAG=`echo $(git describe --tags --abbrev=0)`" >> $GITHUB_ENV
          echo "COMMIT_COUNT=`echo $(git rev-list --count $CURRENT_TAG..master)`" >> $GITHUB_ENV
      - if: ${{env.COMMIT_COUNT >= 5}}
        run: |
          new=echo $CURRENT_TAG | awk 'BEGIN{FS=OFS="."} {$3+=1} 1'
          echo "NEW_TAG=$new" >> $GITHUB_ENV
      - run: |
          echo "CURRENT_TAG: $CURRENT_TAG"
          echo "NEW_TAG: $NEW_TAG"
          echo "COMMIT_COUNT: $COMMIT_COUNT"
  make-patch:
    needs: setup-env
    
    runs-on: ubuntu-latest

    if: ${{env.COMMIT_COUNT >= 500}}
    steps:
      - uses: actions/checkout@v5
        with:
          fetch-depth: 0
      - run: echo "patch"
