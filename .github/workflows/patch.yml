name: patch

on:
  push:
    paths:
      - './TEST'
#on:  
  #schedule:
  # - cron: "0 13 * * 1"

jobs:
  makepatch:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - name: Set current tag
        run: echo "CURRENT_TAG=${git describe --tags --abbrev=0}" >> $GITHUB_ENV
      - run: echo "CURRENT_TAG=$CURRENT_TAG"
      - name: Get commits count
        run: echo "COMMIT_COUNT=${git rev-list --count $CURRENT_TAG..master}" >> $GITHUB_ENV
      - if: ${{env.COMMIT_COUNT >= 5}}
      - name: Make a new tag
        run: echo "$CURRENT_TAG" | awk 'BEGIN{FS=OFS="."} {$3+=1} 1'

  
